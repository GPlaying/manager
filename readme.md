# Lab2:物业报修管理
## 系统目标

物业公司利用人力和物资资源为小区的业主提供**高质量的服务**，并进行**成本核算**和**业绩考核**，其主要服务项目之一是维护和保养各种包括业主和小区公共部位的设施，确保它们的正常运行。

系统的主要目标是
1. 及时响应用户的报修，提高用户满意度
2. 考核员工业绩

物业公司的维保部分的工作由工程队承担，通常有两类工作，包括报修和日常巡检，Lab的第一阶段(teamwork)只完成报修部分，日常巡检部分后续发布，每人单独完成。

## 报修

### 正常流程  
报修通常由业主发起，通常是用户遇到的突发情况，比如断电，下水道阻塞，电梯故障等。业主通过报修电话或者微信群报修，业主描述故障信息后，物业工程队的调度员将报修信息录入系统，作为待调度的任务，内容包括报修时间、故障内容、报修人、报修来源（比如微信、电话）等。调度员在合适的时间对报修进行任务调度，将任务分配给合适的维修工人。维修工人收到任务后会去现场维修，并在系统中留下维修记录，维修记录包括完成时间，处理过程。任务完成后，会通知报修人，请报修人给出评价，评价内容包括响应及时度、服务态度评分\对结果的满意度(1~5分)

### 扩展流程

1. 多次调度
   
   有时候派去的维修工考察了现场后，发现他的工种无法处理该故障，比如用户报告的故障是停电，但实际的原因是管道漏水。这时候需要完成当前的调度，重新调度，派另外的维修工人。系统中只能有最多一个活动的调度。

2. 需要多次执行的活动
   
    有些复杂的故障，维修工人一次无法完成，需要分多次，甚至在几天内完成。维修工人每次开始一次活动都需要单独记录本次处理过程的开始时间，结束后需要记录结束时间以及处理的内容，便于计算工时，统计工作量。

3. 故障类型与维修工人工种的匹配
   
   报修人报修后，调度员需要根据报修内容确定故障的类别，而每个维修工都登记了他能处理的故障分类，一个维修工可以处理一个或多个故障类别。这样，在调度时，调度员在选择了故障类别后，系统可以推荐相关的维修工人

4. 投诉
   
   用户如果不满意报修的处理，可以随时对此发起投诉（可以多次），投诉的内容为一段描述投诉内容的文字。每个到当前为止参与了该报修处理的维修工人和该报修的调度员可以收到该投诉并需要提交情况说明，物业经理在所有相关维修工人都提交了情况说明后，进行投诉处理，与客户沟通并将情况记录下来，关闭该投诉。


用户通过系统能够
1. 调度员需要了解报修的状态，包括解调度的过程以及维修工的活动记录
2. 维修工人需要了解当前分配给他的各种任务已经完成情况，包括调度给他的报修和需要他处理的投诉。
3. 对于处理中的报修，知道当前活动的调度。
4. 需要知道一个维修工人当前是否空闲，以便合理调度
5. 统计处理一次报修已经用掉的工时


## Lab内容
注意，本Lab不需要完成界面部分，只需要完成自动测试
1. 模型(35%)：完成使用UML图设计的领域模型，需要有使用类图表达的概念、属性和概念之间的关系。另外选择比较重要的2个概念给出状态图
2. 实现(65%)：可以使用任意程序设计语言实现该领域模型，对需求中给出的场景使用自动化测试验证设计的流畅性和逻辑的正确性。

注意：代码实现时，可以将所有实体的内容放在内存中，也就是说不需要Persistence，这样可获得实现部分的85%的得分，对于有余力的同学可以完成与数据库对接的部分，可获得实现部分另外的15%。

## 进度安排
1. 两周后（第14周）会选择两组报名的小组，安排一次不超过45分钟的模型部分的review，不占用上课时间，会录屏发布。
2. 16周结束提交Lab和PPT，发布Lab3(个人部分)。 
3. 17、18周pre


### 第一次会议
1. 身份：业主、维修工、调度员

## 框架整理
### (1) 业主
* 报修申请：报修内容填写，并通过“电话”或“微信”发送给调度员
* 维修评价：当报修任务结束时，报修表会出现在此页面
* 投诉申请：当报修任务结束时，报修表会出现在此页面

### (2) 调度员
* 申请管理：业主提交的报修表为待确认状态，只有调度员点击“确认”后，该报修表才会进行待调度队列中等待调度
* 调度管理：“确认”后的报修表会出现在此页面，将报修任务按照故障类型分配给对应的维修工（先空闲后非空闲）
* 投诉处理：业主投诉的维修任务会出现在此页面，需要填写情况说明

### (3) 维修工
* 报修处理：收到来自调度员分配的报修任务
   - 当发现故障类型有误时，会修改报修表中故障类型字段并将该表回传到调度员的“调度管理”页面
   - 填写维修记录
* 投诉处理：业主投诉的维修任务会出现在此页面，需要填写情况说明

### (4) 物业经理
* 投诉处理：只有当调度员和维修工提交情况说明后，才会处理投诉（投诉记录状态修改为“关闭”）


## 案例项目实战
1. 建立SpringBoot项目：
   - https://www.jianshu.com/p/93022d0d1fcc
   - https://blog.csdn.net/qq_44333980/article/details/124508264

2. 案例参考：
   - https://blog.csdn.net/weixin_47971206/article/details/121711708
   - https://blog.csdn.net/weixin_47971206/article/details/121865094

3. SpromgBoot从入门到精通：https://blog.csdn.net/weixin_47872288/article/details/119514865?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166696902516782390526527%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166696902516782390526527&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-3-119514865-null-null.142%5Ev62%5Epc_search_tree,201%5Ev3%5Econtrol_2,213%5Ev1%5Econtrol&utm_term=springboot&spm=1018.2226.3001.4187

4. springBoot注解 
   - @RestController：用于标注控制层组件(如struts中的action)，@ResponseBody和@Controller的合集
   - @RequestMapping：提供路由信息，负责URL到Controller中的具体函数的映射
   - @Configuration：相当于传统的xml配置文件
   - @Entity：@Table(name=”“)：表明这是一个实体类。一般用于jpa这两个注解一般一块使用，但是如果表名和实体类名相同的话，@Table可以省略
   - @Id：表示该属性为主键
   - @GeneratedValue(strategy = GenerationType.SEQUENCE,generator = “repair_seq”)：表示主键生成策略是sequence(可以为Auto、IDENTITY、native等，Auto表示可在多个数据库间切换)，指定sequence的名字是repair_seq
   - @Getter@Setter：作用于属性上,自动生成get,set方法
   - @ToString：用于打印输出字符串
   - @Entity：表示该类是要给实体类，在项目启动时会根据该类自动生成一张表，表的名称即@Entity注解中name的值，如果不配置name，默认表明为类名
   - @Data ： 注在类上，提供类的get、set、equals、hashCode、canEqual、toString方法
   - @Autowired：可以对成员变量、方法和构造函数进行标注，来完成自动装配的工作，@Autowired标注可以放在成员变量上，也可以放在成员变量的set方法上，也可以放在任意方法上表示，自动执行当前方法,统一初始化之后要用的话就直接拿
   - @NoArgsConstructor：注解在类上，为类提供一个无参的构造方法
   - @Transactional：是声明式事务管理编程中使用的注解，应该只被应用到 public 方法上，将标签放置在需要进行事务管理的方法上，而不是放在所有接口实现类上，实质是使用了 JDBC 的事务来进行事务控制的，基于 Spring 的动态代理的机制

5. SpringBoot——配置文件里的全局变量
   - https://blog.csdn.net/weixin_43487532/article/details/120439639

6. SpringBoot连接数据的操作
   - 在idea中安装Database Navigator、Database Tool、JPA SQL插件，详见 https://blog.csdn.net/qq_34767784/article/details/105874355
   - idea连接Mysql数据库，详见 https://blog.csdn.net/chenshun123/article/details/51288814

7. Spring Data JPA - 参考文档：https://www.springcloud.cc/spring-data-jpa.html#repositories.query-methods.query-lookup-strategies


8. 项目架构解析
   - bean	数据层（存放数据类）
   - config	存放一些基本配置文件
   - controller	控制层（处理客户端的请求），也就是调用service提供的服务（即方法）
   - repository	相当于DAO层（数据访问层，和数据库打交道），也就是将数据映射到数据库中
   - service	业务层的接口类（定义接口方法）
   - serviceImpl	业务层的实现类（处理逻辑）

9. 项目架构解释
   - lombok注解
   - springboot框架
   - mysql数据库
   - Jpa数据访问方案

10. 项目启动步骤
   - 如果社区版创建不了SpringBoot项目的话，可以参考第1条说明
   - 在“项目设置”一栏中将项目src\main\con设置为源文件、src\main\resources设置为资源文件即可
   - 编辑配置（榔头符号旁边的选项），选择Spring Boot,并将main.com.example.manage.ManageApplication设置为“主类”（这部分会有提示）
   - 在resources中application.yml中配置数据库连接信息
   - 即可构建并运行起来



